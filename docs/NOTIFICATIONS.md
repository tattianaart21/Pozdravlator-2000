# Уведомления о событиях: как пользователь узнаёт, что пора поздравить

Если пользователь не заходит в Поздравлятор, он может не вспомнить о дне рождения. Ниже — варианты, как доставить напоминание (с согласия пользователя).

---

## 1. Google Календарь (уже работает)

**Как устроено:** пользователь добавляет напоминание в Google Календарь (из приложения или после сохранения контакта). В описание события подставляется ссылка на Поздравлятор — по ней можно быстро открыть генератор поздравлений.

**Что делает пользователь:**
- При добавлении контакта — в модалке нажимает «Добавить в Google Календарь» (откроется форма Google с датой и ссылкой).
- В разделе «Календарь» — у каждого события есть кнопка «Google» для добавления в календарь.

**Уведомления:** Google сам присылает напоминания (за день, за час — настраивается в календаре). Отдельного бэкенда не нужно.

**Ограничение:** пользователь должен сам один раз добавить событие в Google; без этого напоминания от Поздравлятора не придут.

---

## 2. Telegram (нужна доработка бэкенда)

Чтобы пользователь получал напоминание в Telegram, нужны:

1. **Согласие:** в настройках Поздравлятора — «Включить напоминания в Telegram» (чекбокт/кнопка).
2. **Привязка аккаунта:** пользователь переходит по ссылке «Привязать Telegram» или пишет боту команду (например `/start <код>`). Код выдаётся в веб-приложении после включения уведомлений.
3. **Хранение:** в БД (Supabase) — таблица привязок: `user_id` (Supabase Auth) и `telegram_chat_id` (получается из Telegram Bot API после того, как пользователь написал боту).
4. **Бот:** создать бота через [@BotFather](https://t.me/BotFather), получить токен, хранить его в секретах (Supabase Edge Function или отдельный сервис).
5. **Расписание:** раз в день (cron) запускать Edge Function или отдельный job: для каждого пользователя с включёнными напоминаниями получить предстоящие события (за 1–3 дня), отправить в Telegram сообщение с текстом вроде «Завтра ДР у Олеси. Сгенерировать поздравление: [ссылка на Поздравлятор]».
6. **Ссылка:** в сообщении — прямая ссылка на `/generate?contactId=...`, чтобы по нажатию открывался генератор с уже выбранным контактом.

**Технически:** Supabase Edge Functions не имеют встроенного cron; можно использовать [Supabase pg_cron](https://supabase.com/docs/guides/database/extensions/pgcron) (вызов HTTP по расписанию) или внешний сервис (Vercel Cron, GitHub Actions, cron на сервере), который раз в день дергает Edge Function «send-reminders».

---

## 3. PWA и push-уведомления в браузере

Можно добавить Web Push: пользователь разрешает уведомления в браузере, бэкенд по расписанию отправляет push (через VAPID). Тогда напоминание приходит даже при закрытой вкладке (если браузер разрешает). Для этого нужны: серверная отправка (Edge Function + web-push библиотека), хранение подписок (subscription) в БД и cron, как в варианте с Telegram.

---

## Рекомендация

- **Сейчас:** использовать Google Календарь — после добавления контакта предлагать «Добавить в Google Календарь», в описание подставлять ссылку на Поздравлятор. Напоминания пользователь получает от Google.
- **Дальше:** при необходимости добавить Telegram по схеме выше (согласие → привязка → cron + отправка в Telegram с ссылкой на генератор).
